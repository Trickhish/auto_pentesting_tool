import argparse
import os
import platform
import re
import subprocess
from colored import fg,attr,Fore
import random

from tools import *
from web import WebAnalysis


def rgbtoA(b,r,g):
    return(16 + 36 * r // 256 + 6 * g // 256 + b // 256)
    
if __name__ == '__main__':
    system = platform.system()
    if system!="Linux":
        raise Exception("Platform Error: This program is meant to be used on Linux only.")
    cl = Fore.rgb(random.randint(50,255), random.randint(50,255), random.randint(50,255))
    print(f'''{cl}  ___        _                        _           _ 
 / _ \      | |                      | |         | |
/ /_\ \_   _| |_ ___  _ __ ___   __ _| |_ ___  __| |
|  _  | | | | __/ _ \| '_ ` _ \ / _` | __/ _ \/ _` |
| | | | |_| | || (_) | | | | | | (_| | ||  __/ (_| |
\_| |_/\__,_|\__\___/|_| |_| |_|\__,_|\__\___|\__,_|
______          _            _   _                  
| ___ \        | |          | | (_)                 
| |_/ /__ _ __ | |_ ___  ___| |_ _ _ __   __ _      
|  __/ _ \ '_ \| __/ _ \/ __| __| | '_ \ / _` |     
| | |  __/ | | | ||  __/\__ \ |_| | | | | (_| |     
\_|  \___|_| |_|\__\___||___/\__|_|_| |_|\__, |     
 _____           _                        __/ |   
|_   _|         | |                      |___/        
  | | ___   ___ | |                                 
  | |/ _ \ / _ \| |                                 
  | | (_) | (_) | |                                 
  \_/\___/ \___/|_|         
   {attr(0)}''')
    
    parser = argparse.ArgumentParser(description='Automatic Pentesting Tool')
    parser.add_argument('host', type=str, help='host/ip adress')

    args = parser.parse_args()

    host=args.host
    bhost=host
    pattern = re.compile(r'https?://([^/]+)')
    match = pattern.match(bhost)
    if match:
        bhost=match.group(1)

    if not is_online(bhost):
        raise Exception("Host Error: Host is unreachable")
        
    print(f"ðŸš€ Launching a full scan on {Fore.red}{bhost}{attr(0)}\n")

    ports = {"http":80, "https":443}

    if ("http" in ports.keys()) or ("https" in ports.keys()):
        wa = WebAnalysis(bhost)
        wa.start()
